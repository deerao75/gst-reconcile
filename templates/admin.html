{% extends "base.html" %}
{% block content %}
<section class="panel">
    <h1 style="text-align: center; color: #ffffff;">Admin Dashboard</h1>
    <h2 style="text-align: center;">User Management</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-message {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="user-table-container">
        <table class="user-table">
            <thead>
                <tr>
                    <th>User ID</th>
                    <th>Email</th>
                    <th>Subscribed</th>
                    <th>Expiry Date</th>
                    <th>Is Admin</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.email }}</td>
                    <td>
                        {% if user.subscribed %}
                            <span class="status-active">Yes</span>
                        {% else %}
                            <span class="status-inactive">No</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if user.subscription_expiry_date %}
                            {% if user.subscription_expiry_date < today %}
                                <span class="status-expired">{{ user.subscription_expiry_date.strftime('%Y-%m-%d') }} (Expired)</span>
                            {% else %}
                                {{ user.subscription_expiry_date.strftime('%Y-%m-%d') }}
                            {% endif %}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>
                        {% if user.is_admin %}
                            <span class="status-active">Yes</span>
                        {% else %}
                            No
                        {% endif %}
                    </td>
                    <td class="actions-cell">
                        <a href="{{ url_for('edit_user', user_id=user.id) }}" class="btn-edit">Edit</a>

                        {# Prevent admin from deleting themselves #}
                        {% if session.get('user_id') != user.id %}
                        <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this user?');" style="display: inline;">
                            <button type="submit" class="btn-delete">Delete</button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>

<style>
.user-table-container {
    overflow-x: auto;
    margin-top: 2rem;
}
.user-table {
    width: 100%;
    border-collapse: collapse;
    color: #fff;
}
.user-table th, .user-table td {
    border: 1px solid rgba(255, 255, 255, 0.15);
    padding: 10px 15px;
    text-align: left;
}
.user-table th {
    background-color: rgba(255, 255, 255, 0.1);
    color: #ff9500;
}
.actions-cell {
    display: flex;
    gap: 10px;
    align-items: center;
}
.btn-edit, .btn-delete {
    padding: 6px 12px;
    border-radius: 5px;
    text-decoration: none;
    color: white;
    cursor: pointer;
    border: none;
    font-size: 0.9rem;
}
.btn-edit {
    background-color: #007bff;
}
.btn-edit:hover {
    background-color: #0056b3;
}
.btn-delete {
    background-color: #dc3545;
}
.btn-delete:hover {
    background-color: #c82333;
}
.status-active {
    color: #28a745;
    font-weight: bold;
}
.status-inactive {
    color: #ffc107;
}
.status-expired {
    color: #dc3545;
    font-weight: bold;
}
/* Flash messages */
.flash-message {
  padding: 1rem;
  margin: 1rem 0;
  border-radius: 8px;
  text-align: center;
}
.flash-message.success { background-color: #28a745; color: white; }
.flash-message.danger { background-color: #dc3545; color: white; }
.flash-message.warning { background-color: #ffc107; color: black; }
</style>
{% endblock %}
