{% extends "base.html" %}
{% block content %}
<style>
    .admin-container { padding: 48px 24px; max-width: 1200px; margin: 0 auto; }
    .admin-container h2 { text-align: center; margin-bottom: 24px; }
    table { width: 100%; border-collapse: collapse; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    th, td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #e5e7eb; }
    th { background-color: #f9fafb; font-weight: 600; color: #374151; }
    tr:hover { background-color: #f9fafb; }
    .status-active { color: #059669; font-weight: 600; }
    .status-inactive { color: #d97706; font-weight: 600; }
    .status-expired { color: #dc2626; font-weight: 600; }
</style>

<div class="admin-container">
    <h2>Admin Dashboard - User Management</h2>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Email</th>
                <th>Subscribed</th>
                <th>Expiry Date</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.email }}</td>
                <td>
                    {% if user.subscribed %}
                        <span class="status-active">Yes</span>
                    {% else %}
                        <span class="status-inactive">No</span>
                    {% endif %}
                </td>
                <td>
                    <!-- START: THIS IS THE FIX - Display expiry date -->
                    {{ user.subscription_expiry_date.strftime('%d-%b-%Y') if user.subscription_expiry_date else 'N/A' }}
                    <!-- END: THIS IS THE FIX -->
                </td>
                <td>
                    <!-- START: THIS IS THE FIX - Display subscription status -->
                    {% if user.subscribed and user.subscription_expiry_date and user.subscription_expiry_date >= today %}
                        <span class="status-active">Active</span>
                    {% elif user.subscribed %}
                        <span class="status-expired">Expired</span>
                    {% else %}
                        <span class="status-inactive">Not Subscribed</span>
                    {% endif %}
                    <!-- END: THIS IS THE FIX -->
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
